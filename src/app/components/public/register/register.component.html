<div class="register-container">
    <mat-card class="register-card">
        <mat-card-header class="text-center">
            <mat-card-title class="register-title">Registro</mat-card-title>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
                <!-- Nombre -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nombre</mat-label>
                    <input matInput type="text" formControlName="nombre" />
                    <mat-error *ngIf="registerForm.get('nombre')?.hasError('required')">
                        El nombre es obligatorio.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('nombre')?.hasError('pattern')">
                        Solo se permiten letras y espacios.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('nombre')?.hasError('minlength')">
                        Debe tener al menos 3 caracteres.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('nombre')?.hasError('maxlength')">
                        No debe exceder los 50 caracteres.
                    </mat-error>
                </mat-form-field>

                <!-- Email -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Email</mat-label>
                    <input matInput type="email" formControlName="email" />
                    <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
                        El correo electrónico es obligatorio.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
                        Introduce un correo electrónico válido.
                    </mat-error>
                </mat-form-field>

                <!-- Teléfono -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Teléfono</mat-label>
                    <input matInput type="text" formControlName="telefono" maxlength="10" />
                    <mat-error *ngIf="registerForm.get('telefono')?.hasError('required')">
                        El teléfono es obligatorio.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('telefono')?.hasError('pattern')">
                        Introduce un número de teléfono válido de 10 dígitos.
                    </mat-error>
                </mat-form-field>

                <!-- Contraseña -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Contraseña</mat-label>
                    <input matInput type="password" formControlName="password"
                        [type]="hideNewPassword ? 'password' : 'text'"
                        (input)="checkPasswordStrength(registerForm.get('password')?.value)" />
                    <button mat-icon-button matSuffix type="button" (click)="hideNewPassword = !hideNewPassword"
                        aria-label="Toggle password visibility">
                        <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>

                    <!-- Errores -->
                    <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                        La contraseña es obligatoria.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                        La contraseña debe tener al menos 8 caracteres.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('password')?.hasError('weakPassword')">
                        La contraseña no es lo suficientemente fuerte. Asegúrate de tener al menos un número, una letra
                        mayúscula, una minúscula y un carácter especial.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('password')?.hasError('compromised')">
                        Esta contraseña ha sido comprometida en filtraciones de datos. Por favor, elige otra.
                    </mat-error>
                </mat-form-field>

                <!-- Barra de fortaleza de la contraseña -->
                <mat-progress-bar *ngIf="passwordStrength" mode="determinate" [value]="passwordStrengthValue"
                    [color]="passwordStrengthColor"></mat-progress-bar>


                <!-- Confirmar Contraseña -->
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Confirmar Contraseña</mat-label>
                    <input matInput type="password" formControlName="confirmPassword"
                        [type]="hideConfirmPassword ? 'password' : 'text'" />
                    <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword"
                        aria-label="Toggle password visibility">
                        <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                    <mat-error *ngIf="registerForm.hasError('mismatch')">
                        Las contraseñas no coinciden.
                    </mat-error>
                    <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
                        La confirmación de la contraseña es obligatoria.
                    </mat-error>
                </mat-form-field>

                <div class="actions">
                    <button mat-button class="full-width" type="submit" [disabled]="registerForm.invalid || isLoading">
                        Registrar </button>
                </div>
            </form>

            <div class="footer text-center">
                ¿Tienes una cuenta? <a href="/login">Accede aquí</a>
            </div>
        </mat-card-content>
    </mat-card>
</div>